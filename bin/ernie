#!/usr/bin/env ruby

require 'digest/md5'

$:.unshift(File.join(File.dirname(__FILE__), *%w[.. lib]))
ERNIE_ROOT = File.join(File.dirname(__FILE__), *%w[..])

CMD_LINE_PATH = File.join(ERNIE_ROOT, *%w[lib cli])
CMD_LINE_COMMANDS = Dir[CMD_LINE_PATH + "/*.rb"].map { |fname| File.basename(fname).split(".")[0].downcase }
$:.unshift(CMD_LINE_PATH)

DEFAULT_NODE_NAME = `hostname -s`.chomp + "-#{rand(9999)}"
DEFAULT_MASTER_NODE = "master@solid.local"
DEFAULT_ERLANG_CODEPATHS = %w[ebin]

def cookie_hash(node)
  Digest::MD5.hexdigest(node  + "-ernie")
end

def rel(path)
  File.join(ERNIE_ROOT, path)
end

def code_paths
  DEFAULT_ERLANG_CODEPATHS.map {|n| "-pz #{rel(n)}" }.join(" ") + " \\"
end

require 'optparse'
require 'pp'

begin
  ARGV[0] ? command = ARGV[0].downcase : (raise "No command provided")
  CMD_LINE_COMMANDS.include?(command) ? (require command) : (raise "Invalid command")
rescue => error
  puts "#{error.message}! Valid commands for ernie are:\n#{CMD_LINE_COMMANDS.sort.join(", ")}"
  exit(1)
end